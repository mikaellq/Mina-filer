<!DOCTYPE html>
<html lang="sv">

<head>
    <title>Mikael's Bootstrap Page!</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        canvas {
            border: 1px solid #d3d3d3;
            background-color: #f1f1f1;
        }

    </style>
</head>

<body id="game" scroll="no" style="overflow: hidden" onload="startGame()">
    <script>
        var myGamePiece, playField;
        var posX = 3,
            posY = 5;
        const width = 30,
            height = 30;
        const cwidth = 16,
            cheight = 16;
        var a = [
            [10, 16],
            [10, 15],
            [10, 14],
            [10, 13],
            [10, 12],
            [10, 11],
            [10, 10],
            [10, 9],
            [10, 8],
            [10, 7],
            [10, 6],
            [10, 5],
            [10, 4],
            [5, 0],
            [5, 1],
            [5, 2],
            [5, 3],
            [5, 4],
            [5, 5],
            [5, 6],
            [5, 7],
            [5, 8],
            [5, 9],
            [5, 10],
            [5, 11],
            [5, 12]
        ];

        var stones = [
            [2, 2],
            [3, 3],
            [4, 4],
            [8, 10],
            [13, 1]
        ];

        var goal = [[11,15],[12,15],[13,15],[14,15],[15,15]];
        
        document.getElementById("game").addEventListener("keydown", getKey);

        function getKey() {
            var key = event.keyCode;

            switch (key) {
                case 37:
                    moveMyPiece(-1, 0);
                    break;
                case 39:
                    moveMyPiece(1, 0);
                    break;
                case 38:
                    moveMyPiece(0, -1);
                    break;
                case 40:
                    moveMyPiece(0, 1);
                    break;
                default:
                    //alert("Use the arrow keys dummy!");
            }
        }

        function startGame() {
            myGameArea.start();
            myGamePiece = new component(width, height, "green", posX * width, posY * height);
            var t = writeArea();
        }

        var myGameArea = {
            canvas: document.createElement("canvas"),
            start: function() {
                this.canvas.width = cwidth * width;
                this.canvas.height = cheight * height;
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            }
        }

        function component(w, h, color, x, y) {
            this.width = w;
            this.height = h;
            this.x = x;
            this.y = y;
            ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }

        function moveMyPiece(x, y) {
            var c = "#f1f1f1";
            var t = findElement(goal, posX, posY);
            if (t >= 0) c = "yellow";
            var obstacle = findElement(a, posX + x, posY + y);
            if (obstacle < 0 && isInArea(posX, posY, x, y)) {
                var block = findElement(stones, posX + x, posY + y);
                if (block < 0) {
                    myGamePiece = new component(width, height, c, posX * width, posY * height);
                    posX += x;
                    posY += y;
                    myGamePiece = new component(width, height, "green", posX * width, posY * height);
                }
                else {
                    var bx = stones[block][0];
                    var by = stones[block][1];
                    var obstacle2 = findElement(a, bx + x, by + y);                    
                    if (obstacle2 < 0 && isInArea(bx, by, x, y)) {
                        var block2 = findElement(stones, bx + x, by + y);
                        if (block2 < 0) {
                            bx += x;
                            by += y;
                            stones[block][0] = bx;
                            stones[block][1] = by;
                            myGamePiece = new component(width, height, "blue", bx * width, by * height);
                            
                            myGamePiece = new component(width, height, c, posX * width, posY * height);
                            posX += x;
                            posY += y;
                            myGamePiece = new component(width, height, "green", posX * width, posY * height);
                        }
                        
                    }
                }
            }
            var count = 0;
            var t;
            for (j = 0; j < stones.length; j += 1) {
                t = findElement(goal, stones[j][0], stones[j][1]);
                if (t >=0) {
                    count += 1;
                }
                //alert("j: "+j+" t: "+t+" count: "+count);
            }

            //if (count >= stones.length) {
            //    alert("Stones length: "+stones.length+" Count = "+count);
            //}

            if (count >= stones.length) {
                var para = document.createElement("h1");
                var node = document.createTextNode("SUCCESS!!! Reload to start a new game.");
                para.appendChild(node);

                var element = document.getElementById("game");
                element.appendChild(para);
                //document.getElementById("game").innerHTML = "[h1]SUCCESS!!! Reload to start a new game.[/h1]";
            }

        }

        function findElement(e, x, y) {
            for (i = 0; i < e.length; i += 1) {
                if (e[i][0] == x) {
                    if (e[i][1] == y) {
                        return i;
                    }
                }
            }
            return -1;
        }

        function writeArea() {
            //alert("TEST!");
            for (i = 0; i < a.length; i++) {
                playField = new component(30, 30, "red", a[i][0] * width, a[i][1] * height);
            }

            for (i = 0; i < stones.length; i++) {
                playField = new component(30, 30, "blue", stones[i][0] * width, stones[i][1] * height);
            }

            for (i = 0; i < goal.length; i++) {
                playField = new component(30, 30, "yellow", goal[i][0] * width, goal[i][1] * height);
            }

            return 1;
        }

        function isInArea(px, py, x, y) {
            if (px + x >= 0 && px + x < cwidth && py + y >= 0 && py + y < cheight)
                return true;

            return false;
        }
    </script>
</body>

</html>
